<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ basics.name }} - Resume</title>
    <link rel="stylesheet" href="/css/main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Mono:wght@100..900&family=Noto+Sans:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Header Section -->
    <header>
        <h1>{{ basics.name }}</h1>
        <!-- <p>{{ position_title|default(basics.label) }}</p> -->
        
        <div class="contact-info">
            {% if basics.email %}
            <div class="contact-item">
                <i class="fas fa-envelope"></i>
                <a href="mailto:{{ basics.email }}">{{ basics.email }}</a>
            </div>
            {% endif %}
            
            {% if basics.phone %}
            <div class="contact-item">
                <i class="fas fa-phone"></i>
                <span>{{ basics.phone }}</span>
            </div>
            {% endif %}
            
            {% if basics.url %}
            <div class="contact-item">
                <i class="fas fa-globe"></i>
                <a href="{{ basics.url }}" target="_blank">{{ basics.url }}</a>
            </div>
            {% endif %}
            
            {% if basics.location and basics.location.city %}
            <div class="contact-item">
                <i class="fas fa-map-marker-alt"></i>
                <span>{{ basics.location.city }}{% if basics.location.region %}, {{ basics.location.region }}{% endif %}{% if basics.location.countryCode %}, {{ basics.location.countryCode }}{% endif %}</span>
            </div>
            {% endif %}
        </div>
    </header>

    <!-- Summary Section -->
    {% if basics.summary and basics.summary != "null" %}
    <section class="section">
        <h2>Summary</h2>
        <p>{{ basics.summary }}</p>
    </section>
    {% endif %}
    
    <!-- Education Section - Harvard format typically puts education first -->
    {% if education %}
    <section class="section">
        <div class="section-title">
            <h2>Education</h2>
        </div>
        <div class="section-list">
            {% for edu in education %}
            <div class="education-item">
                <div class="flex flex-row justify-between align-bottom">
                    <h3 class="item-title">{{ edu.institution }}</h3>
                    <div class="flex">
                        <div class="education-item-date">
                            Expected Graduation: {{ ( edu.endDate | datetime_format ) |default('Present') }}
                        </div>
                    </div>
                </div>
                <div class="item-content">
                <p>{{ edu.area }}</p> 
                {% if edu.score %}
                <p>GPA: {{ edu.score }}</p>
                {% endif %}
                {% if edu.courses %}
                <p>Relevant Courses: {{ edu.courses|join(', ') }}</p>
                {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}
    
    <!-- Work Experience Section -->
    {% if work %}
    <section class="section">
        <div class="section-title">
            <h2>Experience</h2>
        </div>
        <div class="section-list">
        {% for job in work %}
        <div class="work-item">
            <div class="flex flex-row justify-between align-bottom">
            <h3 class="item-title">{{ job.name }}</h3>
                <div class="flex">
                    <div class="item-date">
                        {{ job.startDate | datetime_format }} - {{ ( job.endDate | datetime_format ) |default('Present')  }}
                    </div>
                </div>
            </div>

            <p>{{ job.position }}</p>
            <div class="item-content">
                <p>{{ job.summary }}</p>
                {% if job.highlights %}
                <ul>
                    {% for highlight in job.highlights %}
                    <li>{{ highlight }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
                </div>
        </div>
        {% endfor %}
        </div>
    </section>
    {% endif %}
    
    <!-- Selected Projects Section -->
    <section class="section">
        <div class="section-title">
            <h2>Projects</h2>
        </div>
        <div class="section-list">
        {% for project in selected_projects %}
        <div class="project">
            <div class="project-title item-title flex flex-row align-middle py-auto">
                {% if project.url %}
                <a class="my-auto" href="{{ project.url }}" target="_blank">{{ project.name }} <i class="fas fa-external-link-alt fa-xs"></i></a>
                {% else %}
                {{ project.name }}
                {% endif %}
                <div class="w-1 my-auto pb-[1px] font"></div>
                <div class="project-tech">{{ project.technologies }}</div>
            </div>
            <div class="item-content">
            <p>{{ project.description }}</p>
            <ul>
                {% for highlight in project.highlights %}
                <li>{{ highlight }}</li>
                {% endfor %}
            </ul>
            </div>
        </div>
        {% endfor %}
        </div>
    </section>
    <!-- Skills Section -->
    {% if skills %}
    <section class="section">
        <div class="section-title">
            <h2>Skills</h2>
        </div>
        <div class="section-list">
            {% for skill in skills %}
            <div class="skill-group">
                <h3 class="item-title">{{ skill.name }}</h3>
                {% if skill.keywords %}
                <div class="item-content">
                    {% for keyword in skill.keywords %}
                    <span class="keyword">{{ keyword }}</span>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}
    
    <!-- Certificates Section -->
    {% if certificates %}
    <section class="section">
        <div class="section-title">
            <h2>Certificates</h2>
        </div>
        <div class="section-list">
            <ul>
                {% for cert in certificates %}
                <li class="certificate-item">
                    {% if cert.url %}
                    <a href="{{ cert.url }}" target="_blank" class="item-title"><strong>{{ cert.name }}</strong></a>
                    {% else %}
                    <strong class="item-title">{{ cert.name }}</strong>
                    {% endif %}
                    <span class="item-content"> - {{ cert.issuer }} ({{ cert.date }})</span>
                </li>
                {% endfor %}
            </ul>
        </div>
    </section>
    {% endif %}
    
    <!-- Languages Section -->
    {% if languages %}
    <section class="section">
        <div class="section-title">
            <h2>Languages</h2>
        </div>
        <div class="section-list">
            <ul>
                {% for lang in languages %}
                <li class="language-item">
                    <strong class="item-title">{{ lang.language }}</strong>: 
                    <span class="item-content">{{ lang.fluency }}</span>
                </li>
                {% endfor %}
            </ul>
        </div>
    </section>
    {% endif %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Connect to the SSE endpoint
            const eventSource = new EventSource('/events');
            
            // Log connection status
            eventSource.onopen = function() {
                console.log('SSE connection opened');
            };
            
            eventSource.onerror = function(error) {
                console.error('SSE error:', error);
                // Try to reconnect after a delay
                setTimeout(() => {
                    console.log('Attempting to reconnect...');
                    eventSource.close();
                    new EventSource('/events');
                }, 5000);
            };
            
            // Handle incoming events
            eventSource.onmessage = function(event) {
                console.log('SSE message received:', event.data);
                const data = JSON.parse(event.data);
                if (data.event === 'refresh') {
                    console.log('Refreshing page due to content change...');
                    window.location.reload();
                }
            };
        });
    </script>
</body>
</html>