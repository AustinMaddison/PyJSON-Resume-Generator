<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ basics.name }} - Resume</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="../static/css/styles.css">
    <!-- Add Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Header Section -->
    <header>
        <h1>{{ basics.name }}</h1>
        <!-- <p>{{ position_title|default(basics.label) }}</p> -->
        
        <div class="contact-info">
            {% if basics.email %}
            <div class="contact-item">
                <i class="fas fa-envelope"></i>
                <a href="mailto:{{ basics.email }}">{{ basics.email }}</a>
            </div>
            {% endif %}
            
            {% if basics.phone %}
            <div class="contact-item">
                <i class="fas fa-phone"></i>
                <span>{{ basics.phone }}</span>
            </div>
            {% endif %}
            
            {% if basics.url %}
            <div class="contact-item">
                <i class="fas fa-globe"></i>
                <a href="{{ basics.url }}" target="_blank">{{ basics.url }}</a>
            </div>
            {% endif %}
            
            {% if basics.location and basics.location.city %}
            <div class="contact-item">
                <i class="fas fa-map-marker-alt"></i>
                <span>{{ basics.location.city }}{% if basics.location.region %}, {{ basics.location.region }}{% endif %}{% if basics.location.countryCode %}, {{ basics.location.countryCode }}{% endif %}</span>
            </div>
            {% endif %}
        </div>
    </header>

    <!-- Summary Section -->
    {% if basics.summary and basics.summary != "null" %}
    <section class="section">
        <h2>Summary</h2>
        <p>{{ basics.summary }}</p>
    </section>
    {% endif %}
    
    <!-- Education Section - Harvard format typically puts education first -->
    {% if education %}
    <section class="section">
        <h2>Education</h2>
        {% for edu in education %}
        <div class="education-item">
            <h3>{{ edu.institution }}</h3>
            <p><strong>{{ edu.studyType }} in {{ edu.area }}</strong> | {{ edu.startDate }} to {{ edu.endDate|default('Present') }}</p>
            {% if edu.score %}
            <p>GPA: {{ edu.score }}</p>
            {% endif %}
            {% if edu.courses %}
            <p>Relevant Courses: {{ edu.courses|join(', ') }}</p>
            {% endif %}
        </div>
        {% endfor %}
    </section>
    {% endif %}
    
    <!-- Work Experience Section -->
    {% if work %}
    <section class="section">
        <h2>Experience</h2>
        {% for job in work %}
        <div class="work-item">
            <h3>{{ job.name }}</h3>
            <p><strong>{{ job.position }}</strong> | {{ job.startDate }} to {{ job.endDate|default('Present') }}</p>
            <p>{{ job.summary }}</p>
            {% if job.highlights %}
            <ul>
                {% for highlight in job.highlights %}
                <li>{{ highlight }}</li>
                {% endfor %}
            </ul>
            {% endif %}
        </div>
        {% endfor %}
    </section>
    {% endif %}
    
    <!-- Selected Projects Section -->
    <section class="section">
        <h2>Projects</h2>
        {% for project in selected_projects %}
        <div class="project">
            <div class="project-title">
                {% if project.url %}
                <a href="{{ project.url }}" target="_blank">{{ project.name }} <i class="fas fa-external-link-alt fa-xs"></i></a>
                {% else %}
                {{ project.name }}
                {% endif %}
            </div>
            <div class="project-tech">{{ project.technologies }}</div>
            <p>{{ project.description }}</p>
            <ul>
                {% for highlight in project.highlights %}
                <li>{{ highlight }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endfor %}
    </section>
    
    <!-- Skills Section -->
    {% if skills %}
    <section class="section">
        <h2>Skills</h2>
        {% for skill in skills %}
        <div class="skill-group">
            <h3>{{ skill.name }}</h3>
            {% if skill.keywords %}
            <div class="skill-keywords">
                {% for keyword in skill.keywords %}
                <span class="keyword">{{ keyword }}</span>
                {% endfor %}
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </section>
    {% endif %}
    
    <!-- Certificates Section -->
    {% if certificates %}
    <section class="section">
        <h2>Certificates</h2>
        <ul>
        {% for cert in certificates %}
            <li>
                {% if cert.url %}
                <a href="{{ cert.url }}" target="_blank"><strong>{{ cert.name }}</strong></a>
                {% else %}
                <strong>{{ cert.name }}</strong>
                {% endif %}
                - {{ cert.issuer }} ({{ cert.date }})
            </li>
        {% endfor %}
        </ul>
    </section>
    {% endif %}
    
    <!-- Languages Section -->
    {% if languages %}
    <section class="section">
        <h2>Languages</h2>
        <ul>
        {% for lang in languages %}
            <li><strong>{{ lang.language }}</strong>: {{ lang.fluency }}</li>
        {% endfor %}
        </ul>
    </section>
    {% endif %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Connect to the SSE endpoint
            const eventSource = new EventSource('/events');
            
            // Log connection status
            eventSource.onopen = function() {
                console.log('SSE connection opened');
            };
            
            eventSource.onerror = function(error) {
                console.error('SSE error:', error);
                // Try to reconnect after a delay
                setTimeout(() => {
                    console.log('Attempting to reconnect...');
                    eventSource.close();
                    new EventSource('/events');
                }, 5000);
            };
            
            // Handle incoming events
            eventSource.onmessage = function(event) {
                console.log('SSE message received:', event.data);
                const data = JSON.parse(event.data);
                if (data.event === 'refresh') {
                    console.log('Refreshing page due to content change...');
                    window.location.reload();
                }
            };
        });
    </script>
</body>
</html>